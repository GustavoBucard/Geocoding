<!DOCTYPE html>
<html>

<head>
  <title>Mapa Covid19 UFRJ</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <style>
    #map {
      height: 100%;
    }

    html,
    body {
      height: 100%;
      padding-top: 1em;
    }

    .container {
      left: 10px;
      max-width: 95%;
      height: 30em;
      border: 2px solid #000000;
      padding: 2px;
      margin: auto;
    }
  </style>
</head>

<body>
  <div class='container'>
    <div id="map"></div>
  </div>
  <div>
    </br>
    <input style="margin-left: 45%;" text-align="center" value="Home" background-color="blue" type="button" />
  </div>
  <script>

    var geocoder;
    var map;
    var addressData = [{ location: "Ilha do Fundão, Rio de Janeiro" }, { location: "Gogó da Ema, Rio de Janeiro" }, { location: "Morro dos Macacos, Rio de Janeiro" }];

    function initMap() {
      var map = new google.maps.Map(
        document.getElementById("map"), {
        center: new google.maps.LatLng(-22.8576, -43.2004),
        zoom: 10,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      });
      var coordinates = [{}];
      var geocoder = new google.maps.Geocoder();
      var bounds = new google.maps.LatLngBounds();

      function findLatLang(address, geocoder, mainMap) {
        return new Promise(function (resolve, reject) {
          geocoder.geocode({
            'address': address
          }, function (results, status) {
            if (status === 'OK') {
              //console.log(results);
              resolve([results[0].geometry.location.lat(), results[0].geometry.location.lng()]);
            } else {
              reject(new Error('Couldnt\'t find the location ' + address));
            }
          })
        })
      }

      function getPoints(geocoder, map) {
        let locationData = [];
        let latValue;
        for (let i = 0; i < addressData.length; i++) {
          locationData.push(findLatLang(addressData[i].location, geocoder, map))
        }
        return locationData // array of promises
      }

      var locations = getPoints(geocoder, map)

      Promise.all(locations)
        .then(function (returnVals) {
          var location = []
          var x = 0
          // you should have return values here when
          // all promises have rsolved
          //console.log(returnVals);
          coordinates = returnVals;
          returnVals.forEach(function (latLng) {
            console.log(latLng[0], latLng[1])
            location[x] = new google.maps.LatLng(latLng[0], latLng[1])
            console.log(latLng);
            x++
          })
          var heatmap = new google.maps.visualization.HeatmapLayer({
            data: location,
            radius: 50,
            opacity: 0.4
          });
          console.log(location)

          heatmap.setMap(map);
        })
    }

  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBy5sPPL58np_vCYP9laO4QbJdH3WT71tc&libraries=places,visualization&callback=initMap">
    </script>
</body>

</html>